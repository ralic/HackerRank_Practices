<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>20.&nbsp;Security HTTP Response Headers</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Security Reference"><link rel="up" href="web-app-security.html" title="Part&nbsp;IV.&nbsp;Web Application Security"><link rel="prev" href="cors.html" title="19.&nbsp;CORS"><link rel="next" href="session-mgmt.html" title="21.&nbsp;Session Management"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">20.&nbsp;Security HTTP Response Headers</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="cors.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;IV.&nbsp;Web Application Security</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="session-mgmt.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="headers" href="#headers"></a>20.&nbsp;Security HTTP Response Headers</h2></div></div></div>

<p>This section discusses Spring Security&#8217;s support for adding various security headers to the response.</p>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="default-security-headers" href="#default-security-headers"></a>20.1&nbsp;Default Security Headers</h2></div></div></div>

<p>Spring Security allows users to easily inject the default security headers to assist in protecting their application.
The default for Spring Security is to include the following headers:</p>
<pre class="programlisting">Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Pragma: no-cache
Expires: 0
X-Content-Type-Options: nosniff
Strict-Transport-Security: max-age=31536000 ; includeSubDomains
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Strict-Transport-Security is only added on HTTPS requests</p>
</td></tr></table></div>
<p>For additional details on each of these headers, refer to the corresponding sections:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="link" href="headers.html#headers-cache-control" title="20.1.1&nbsp;Cache Control">Cache Control</a>
</li><li class="listitem">
<a class="link" href="headers.html#headers-content-type-options" title="20.1.2&nbsp;Content Type Options">Content Type Options</a>
</li><li class="listitem">
<a class="link" href="headers.html#headers-hsts" title="20.1.3&nbsp;HTTP Strict Transport Security (HSTS)">HTTP Strict Transport Security</a>
</li><li class="listitem">
<a class="link" href="headers.html#headers-frame-options" title="20.1.5&nbsp;X-Frame-Options">X-Frame-Options</a>
</li><li class="listitem">
<a class="link" href="headers.html#headers-xss-protection" title="20.1.6&nbsp;X-XSS-Protection">X-XSS-Protection</a>
</li></ul></div>
<p>While each of these headers are considered best practice, it should be noted that not all clients utilize the headers, so additional testing is encouraged.</p>
<p>You can customize specific headers.
For example, assume that want your HTTP response headers to look like the following:</p>
<pre class="programlisting">Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Pragma: no-cache
Expires: 0
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block</pre>
<p>Specifically, you want all of the default headers with the following customizations:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="link" href="headers.html#headers-frame-options" title="20.1.5&nbsp;X-Frame-Options">X-Frame-Options</a> to allow any request from same domain
</li><li class="listitem">
<a class="link" href="headers.html#headers-hsts" title="20.1.3&nbsp;HTTP Strict Transport Security (HSTS)">HTTP Strict Transport Security (HSTS)</a> will not be addded to the response
</li></ul></div>
<p>You can easily do this with the following Java Configuration:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
		WebSecurityConfigurerAdapter {

	<em><span class="hl-annotation" style="color: gray">@Override</span></em>
	<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
		http
			<span class="hl-comment">// ...</span>
			.headers()
				.frameOptions().sameOrigin()
				.httpStrictTransportSecurity().disable();
	}
}</pre>
<p>Alternatively, if you are using Spring Security XML Configuration, you can use the following:</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers&gt;</span>
		<span class="hl-tag">&lt;frame-options</span> <span class="hl-attribute">policy</span>=<span class="hl-value">"SAMEORIGIN"</span><span class="hl-tag"> /&gt;</span>
		<span class="hl-tag">&lt;hsts</span> <span class="hl-attribute">disable</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;/headers&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span></pre>
<p>If you do not want the defaults to be added and want explicit control over what should be used, you can disable the defaults.
An example for both Java and XML based configuration is provided below:</p>
<p>If you are using Spring Security&#8217;s Java Configuration the following will only add <a class="link" href="headers.html#headers-cache-control" title="20.1.1&nbsp;Cache Control">Cache Control</a>.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
WebSecurityConfigurerAdapter {

<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
	http
	<span class="hl-comment">// ...</span>
	.headers()
		<span class="hl-comment">// do not use any default headers unless explicitly listed</span>
		.defaultsDisabled()
		.cacheControl();
}
}</pre>
<p>The following XML will only add <a class="link" href="headers.html#headers-cache-control" title="20.1.1&nbsp;Cache Control">Cache Control</a>.</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers</span> <span class="hl-attribute">defaults-disabled</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;cache-control/&gt;</span>
	<span class="hl-tag">&lt;/headers&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span></pre>
<p>If necessary, you can disable all of the HTTP Security response headers with the following Java Configuration:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
WebSecurityConfigurerAdapter {

<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
	http
	<span class="hl-comment">// ...</span>
	.headers().disable();
}
}</pre>
<p>If necessary, you can disable all of the HTTP Security response headers with the following XML configuration below:</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers</span> <span class="hl-attribute">disabled</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span></pre>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="headers-cache-control" href="#headers-cache-control"></a>20.1.1&nbsp;Cache Control</h3></div></div></div>

<p>In the past Spring Security required you to provide your own cache control for your web application. This seemed reasonable at the time, but browser caches have evolved to include caches for secure connections as well. This means that a user may view an authenticated page, log out, and then a malicious user can use the browser history to view the cached page. To help mitigate this Spring Security has added cache control support which will insert the following headers into you response.</p>
<pre class="screen">Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Pragma: no-cache
Expires: 0</pre>
<p>Simply adding the <a class="link" href="appendix-namespace.html#nsa-headers" title="41.1.5&nbsp;<headers&gt;">&lt;headers</a>&gt; element with no child elements will automatically add Cache Control and quite a few other protections.
However, if you only want cache control, you can enable this feature using Spring Security&#8217;s XML namespace with the <a class="link" href="appendix-namespace.html#nsa-cache-control" title="41.1.6&nbsp;<cache-control&gt;">&lt;cache-control</a>&gt; element and the <a class="link" href="appendix-namespace.html#nsa-headers-defaults-disabled">headers@defaults-disabled</a> attribute.</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers</span> <span class="hl-attribute">defaults-disable</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;cache-control /&gt;</span>
	<span class="hl-tag">&lt;/headers&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span></pre>
<p>Similarly, you can enable only cache control within Java Configuration with the following:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
WebSecurityConfigurerAdapter {

<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
	http
	<span class="hl-comment">// ...</span>
	.headers()
		.defaultsDisabled()
		.cacheControl();
}
}</pre>
<p>If you actually want to cache specific responses, your application can selectively invoke <a class="ulink" href="http://docs.oracle.com/javaee/6/api/javax/servlet/http/HttpServletResponse.html#setHeader(java.lang.String,java.lang.String)" target="_top">HttpServletResponse.setHeader(String,String)</a> to override the header set by Spring Security. This is useful to ensure things like CSS, JavaScript, and images are properly cached.</p>
<p>When using Spring Web MVC, this is typically done within your configuration. For example, the following configuration will ensure that the cache headers are set for all of your resources:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebMvcConfiguration <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

	<em><span class="hl-annotation" style="color: gray">@Override</span></em>
	<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
		registry
			.addResourceHandler(<span class="hl-string">"/resources/**"</span>)
			.addResourceLocations(<span class="hl-string">"/resources/"</span>)
			.setCachePeriod(<span class="hl-number">31556926</span>);
	}

	<span class="hl-comment">// ...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="headers-content-type-options" href="#headers-content-type-options"></a>20.1.2&nbsp;Content Type Options</h3></div></div></div>

<p>Historically browsers, including Internet Explorer, would try to guess the content type of a request using <a class="ulink" href="http://en.wikipedia.org/wiki/Content_sniffing" target="_top">content sniffing</a>. This allowed browsers to improve the user experience by guessing the content type on resources that had not specified the content type. For example, if a browser encountered a JavaScript file that did not have the content type specified, it would be able to guess the content type and then execute it.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>There are many additional things one should do (i.e. only display the document in a distinct domain, ensure Content-Type header is set, sanitize the document, etc) when allowing content to be uploaded. However, these measures are out of the scope of what Spring Security provides. It is also important to point out when disabling content sniffing, you must specify the content type in order for things to work properly.</p>
</td></tr></table></div>
<p>The problem with content sniffing is that this allowed malicious users to use polyglots (i.e. a file that is valid as multiple content types) to execute XSS attacks. For example, some sites may allow users to submit a valid postscript document to a website and view it. A malicious user might create a <a class="ulink" href="http://webblaze.cs.berkeley.edu/papers/barth-caballero-song.pdf" target="_top">postscript document that is also a valid JavaScript file</a> and execute a XSS attack with it.</p>
<p>Content sniffing can be disabled by adding the following header to our response:</p>
<pre class="screen">X-Content-Type-Options: nosniff</pre>
<p>Just as with the cache control element, the nosniff directive is added by default when using the &lt;headers&gt; element with no child elements.
However, if you want more control over which headers are added you can use the <a class="link" href="appendix-namespace.html#nsa-content-type-options" title="41.1.15&nbsp;<content-type-options&gt;">&lt;content-type-options</a>&gt; element and the <a class="link" href="appendix-namespace.html#nsa-headers-defaults-disabled">headers@defaults-disabled</a> attribute as shown below:</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers</span> <span class="hl-attribute">defaults-disabled</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;content-type-options /&gt;</span>
	<span class="hl-tag">&lt;/headers&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span></pre>
<p>The X-Content-Type-Options header is added by default with Spring Security Java configuration. If you want more control over the headers, you can explicitly specify the content type options with the following:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
WebSecurityConfigurerAdapter {

<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
	http
	<span class="hl-comment">// ...</span>
	.headers()
		.defaultsDisabled()
		.contentTypeOptions();
}
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="headers-hsts" href="#headers-hsts"></a>20.1.3&nbsp;HTTP Strict Transport Security (HSTS)</h3></div></div></div>

<p>When you type in your bank&#8217;s website, do you enter mybank.example.com or do you enter <a class="ulink" href="https://mybank.example.com" target="_top">https://mybank.example.com</a>? If you omit the https protocol, you are potentially vulnerable to <a class="ulink" href="http://en.wikipedia.org/wiki/Man-in-the-middle_attack" target="_top">Man in the Middle attacks</a>. Even if the website performs a redirect to <a class="ulink" href="https://mybank.example.com" target="_top">https://mybank.example.com</a> a malicious user could intercept the initial HTTP request and manipulate the response (i.e. redirect to <a class="ulink" href="https://mibank.example.com" target="_top">https://mibank.example.com</a> and steal their credentials).</p>
<p>Many users omit the https protocol and this is why <a class="ulink" href="http://tools.ietf.org/html/rfc6797" target="_top">HTTP Strict Transport Security (HSTS)</a> was created. Once mybank.example.com is added as a <a class="ulink" href="http://tools.ietf.org/html/rfc6797#section-5.1" target="_top">HSTS host</a>, a browser can know ahead of time that any request to mybank.example.com should be interpreted as <a class="ulink" href="https://mybank.example.com" target="_top">https://mybank.example.com</a>. This greatly reduces the possibility of a Man in the Middle attack occurring.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>In accordance with <a class="ulink" href="http://tools.ietf.org/html/rfc6797#section-7.2" target="_top">RFC6797</a>, the HSTS header is only injected into HTTPS responses. In order for the browser to acknowledge the header, the browser must first trust the CA that signed the SSL certificate used to make the connection (not just the SSL certificate).</p>
</td></tr></table></div>
<p>One way for a site to be marked as a HSTS host is to have the host preloaded into the browser. Another is to add the "Strict-Transport-Security" header to the response. For example the following would instruct the browser to treat the domain as an HSTS host for a year (there are approximately 31536000 seconds in a year):</p>
<pre class="screen">Strict-Transport-Security: max-age=31536000 ; includeSubDomains</pre>
<p>The optional includeSubDomains directive instructs Spring Security that subdomains (i.e. secure.mybank.example.com) should also be treated as an HSTS domain.</p>
<p>As with the other headers, Spring Security adds HSTS by default. You can customize HSTS headers with the <a class="link" href="appendix-namespace.html#nsa-hsts" title="41.1.7&nbsp;<hsts&gt;">&lt;hsts</a>&gt; element as shown below:</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers&gt;</span>
		<span class="hl-tag">&lt;hsts</span>
			<span class="hl-attribute">include-subdomains</span>=<span class="hl-value">"true"</span>
			<span class="hl-attribute">max-age-seconds</span>=<span class="hl-value">"31536000"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/headers&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span></pre>
<p>Similarly, you can enable only HSTS headers with Java Configuration:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
WebSecurityConfigurerAdapter {

<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
	http
	<span class="hl-comment">// ...</span>
	.headers()
		.httpStrictTransportSecurity()
			.includeSubdomains(true)
			.maxAgeSeconds(<span class="hl-number">31536000</span>);
}
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="headers-hpkp" href="#headers-hpkp"></a>20.1.4&nbsp;HTTP Public Key Pinning (HPKP)</h3></div></div></div>

<p>HTTP Public Key Pinning (HPKP) is a security feature that tells a web client to associate a specific cryptographic public key with a certain web server to prevent Man in the Middle (MITM) attacks with forged certificates.</p>
<p>To ensure the authenticity of a server&#8217;s public key used in TLS sessions, this public key is wrapped into a X.509 certificate which is usually signed by a certificate authority (CA). Web clients such as browsers trust a lot of these CAs, which can all create certificates for arbitrary domain names.
If an attacker is able to compromise a single CA, they can perform MITM attacks on various TLS connections. HPKP can circumvent this threat for the HTTPS protocol by telling the client which public key belongs to a certain web server.
HPKP is a Trust on First Use (TOFU) technique. The first time a web server tells a client via a special HTTP header which public keys belong to it, the client stores this information for a given period of time.
When the client visits the server again, it expects a certificate containing a public key whose fingerprint is already known via HPKP. If the server delivers an unknown public key, the client should present a warning to the user.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Because the user-agent needs to validate the pins against the SSL certificate chain, the HPKP header is only injected into HTTPS responses.</p>
</td></tr></table></div>
<p>Enabling this feature for your site is as simple as returning the Public-Key-Pins HTTP header when your site is accessed over HTTPS.
For example, the following would instruct the user-agent to only report pin validation failures to a given URI (via the <a class="ulink" href="https://tools.ietf.org/html/rfc7469#section-2.1.4" target="_top"><span class="strong"><strong><span class="emphasis"><em>report-uri</em></span></strong></span></a> directive) for 2 pins:</p>
<pre class="screen">Public-Key-Pins-Report-Only: max-age=5184000 ; pin-sha256="d6qzRu9zOECb90Uez27xWltNsj0e1Md7GkYYkVoZWmM=" ; pin-sha256="E9CZ9INDbd+2eRQozYqqbQ2yXLVKB9+xcprMF+44U1g=" ; report-uri="http://example.net/pkp-report" ; includeSubDomains</pre>
<p>A <a class="ulink" href="https://tools.ietf.org/html/rfc7469#section-3" target="_top"><span class="strong"><strong><span class="emphasis"><em>pin validation failure report</em></span></strong></span></a> is a standard JSON structure that can be captured
either by the web application&#8217;s own API or by a publicly hosted HPKP reporting service, such as, <a class="ulink" href="https://report-uri.io/" target="_top"><span class="strong"><strong><span class="emphasis"><em>REPORT-URI</em></span></strong></span></a>.</p>
<p>The optional includeSubDomains directive instructs the browser to also validate subdomains with the given pins.</p>
<p>Opposed to the other headers, Spring Security does not add HPKP by default. You can customize HPKP headers with the <a class="link" href="appendix-namespace.html#nsa-hpkp" title="41.1.8&nbsp;<hpkp&gt;">&lt;hpkp</a>&gt; element as shown below:</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers&gt;</span>
		<span class="hl-tag">&lt;hpkp</span>
			<span class="hl-attribute">include-subdomains</span>=<span class="hl-value">"true"</span>
			<span class="hl-attribute">report-uri</span>=<span class="hl-value">"http://example.net/pkp-report"</span><span class="hl-tag">&gt;</span>
			<span class="hl-tag">&lt;pins&gt;</span>
					<span class="hl-tag">&lt;pin</span> <span class="hl-attribute">algorithm</span>=<span class="hl-value">"sha256"</span><span class="hl-tag">&gt;</span>d6qzRu9zOECb90Uez27xWltNsj0e1Md7GkYYkVoZWmM=<span class="hl-tag">&lt;/pin&gt;</span>
					<span class="hl-tag">&lt;pin</span> <span class="hl-attribute">algorithm</span>=<span class="hl-value">"sha256"</span><span class="hl-tag">&gt;</span>E9CZ9INDbd+2eRQozYqqbQ2yXLVKB9+xcprMF+44U1g=<span class="hl-tag">&lt;/pin&gt;</span>
			<span class="hl-tag">&lt;/pins&gt;</span>
		<span class="hl-tag">&lt;/hpkp&gt;</span>
	<span class="hl-tag">&lt;/headers&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span></pre>
<p>Similarly, you can enable HPKP headers with Java Configuration:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
WebSecurityConfigurerAdapter {

		<em><span class="hl-annotation" style="color: gray">@Override</span></em>
		<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
				http
				<span class="hl-comment">// ...</span>
				.headers()
						.httpPublicKeyPinning()
								.includeSubdomains(true)
								.reportUri(<span class="hl-string">"http://example.net/pkp-report"</span>)
								.addSha256Pins(<span class="hl-string">"d6qzRu9zOECb90Uez27xWltNsj0e1Md7GkYYkVoZWmM="</span>, <span class="hl-string">"E9CZ9INDbd+2eRQozYqqbQ2yXLVKB9+xcprMF+44U1g="</span>;
		}
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="headers-frame-options" href="#headers-frame-options"></a>20.1.5&nbsp;X-Frame-Options</h3></div></div></div>

<p>Allowing your website to be added to a frame can be a security issue. For example, using clever CSS styling users could be tricked into clicking on something that they were not intending (<a class="ulink" href="http://www.youtube.com/watch?v=3mk0RySeNsU" target="_top">video demo</a>). For example, a user that is logged into their bank might click a button that grants access to other users. This sort of attack is known as <a class="ulink" href="http://en.wikipedia.org/wiki/Clickjacking" target="_top">Clickjacking</a>.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Another modern approach to dealing with clickjacking is to use <a class="xref" href="headers.html#headers-csp" title="20.1.7&nbsp;Content Security Policy (CSP)">Section&nbsp;20.1.7, &#8220;Content Security Policy (CSP)&#8221;</a>.</p>
</td></tr></table></div>
<p>There are a number ways to mitigate clickjacking attacks. For example, to protect legacy browsers from clickjacking attacks you can use <a class="ulink" href="https://www.owasp.org/index.php/Clickjacking_Defense_Cheat_Sheet#Best-for-now_Legacy_Browser_Frame_Breaking_Script" target="_top">frame breaking code</a>. While not perfect, the frame breaking code is the best you can do for the legacy browsers.</p>
<p>A more modern approach to address clickjacking is to use <a class="ulink" href="https://developer.mozilla.org/en-US/docs/HTTP/X-Frame-Options" target="_top">X-Frame-Options</a> header:</p>
<pre class="screen">X-Frame-Options: DENY</pre>
<p>The X-Frame-Options response header instructs the browser to prevent any site with this header in the response from being rendered within a frame.
By default, Spring Security disables rendering within an iframe.</p>
<p>You can customize X-Frame-Options with the <a class="link" href="appendix-namespace.html#nsa-frame-options" title="41.1.13&nbsp;<frame-options&gt;">frame-options</a> element.
For example, the following will instruct Spring Security to use "X-Frame-Options: SAMEORIGIN" which allows iframes within the same domain:</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers&gt;</span>
		<span class="hl-tag">&lt;frame-options</span>
		<span class="hl-attribute">policy</span>=<span class="hl-value">"SAMEORIGIN"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/headers&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span></pre>
<p>Similarly, you can customize frame options to use the same origin within Java Configuration using the following:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
WebSecurityConfigurerAdapter {

<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
	http
	<span class="hl-comment">// ...</span>
	.headers()
		.frameOptions()
			.sameOrigin();
}
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="headers-xss-protection" href="#headers-xss-protection"></a>20.1.6&nbsp;X-XSS-Protection</h3></div></div></div>

<p>Some browsers have built in support for filtering out <a class="ulink" href="https://www.owasp.org/index.php/Testing_for_Reflected_Cross_site_scripting_(OWASP-DV-001)" target="_top">reflected XSS attacks</a>. This is by no means foolproof, but does assist in XSS protection.</p>
<p>The filtering is typically enabled by default, so adding the header typically just ensures it is enabled and instructs the browser what to do when a XSS attack is detected. For example, the filter might try to change the content in the least invasive way to still render everything. At times, this type of replacement can become a <a class="ulink" href="http://hackademix.net/2009/11/21/ies-xss-filter-creates-xss-vulnerabilities/" target="_top">XSS vulnerability in itself</a>. Instead, it is best to block the content rather than attempt to fix it. To do this we can add the following header:</p>
<pre class="screen">X-XSS-Protection: 1; mode=block</pre>
<p>This header is included by default. However, we can customize it if we wanted. For example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers&gt;</span>
		<span class="hl-tag">&lt;xss-protection</span> <span class="hl-attribute">block</span>=<span class="hl-value">"false"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;/headers&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span></pre>
<p>Similarly, you can customize XSS protection within Java Configuration with the following:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
WebSecurityConfigurerAdapter {

<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
	http
	<span class="hl-comment">// ...</span>
	.headers()
		.xssProtection()
			.block(false);
}
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="headers-csp" href="#headers-csp"></a>20.1.7&nbsp;Content Security Policy (CSP)</h3></div></div></div>

<p><a class="ulink" href="https://www.w3.org/TR/CSP2/" target="_top">Content Security Policy (CSP)</a> is a mechanism that web applications can leverage to mitigate content injection vulnerabilities,
such as cross-site scripting (XSS). CSP is a declarative policy that provides a facility for web application authors to declare and ultimately inform
the client (user-agent) about the sources from which the web application expects to load resources.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Content Security Policy is not intended to solve all content injection vulnerabilities.
Instead, CSP can be leveraged to help reduce the harm caused by content injection attacks.
As a first line of defense, web application authors should validate their input and encode their output.</p>
</td></tr></table></div>
<p>A web application may employ the use of CSP by including one of the following HTTP headers in the response:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="strong"><strong><span class="emphasis"><em>Content-Security-Policy</em></span></strong></span>
</li><li class="listitem">
<span class="strong"><strong><span class="emphasis"><em>Content-Security-Policy-Report-Only</em></span></strong></span>
</li></ul></div>
<p>Each of these headers are used as a mechanism to deliver a <span class="strong"><strong><span class="emphasis"><em>security policy</em></span></strong></span> to the client.
A security policy contains a set of <span class="strong"><strong><span class="emphasis"><em>security policy directives</em></span></strong></span> (for example, <span class="emphasis"><em>script-src</em></span> and <span class="emphasis"><em>object-src</em></span>),
each responsible for declaring the restrictions for a particular resource representation.</p>
<p>For example, a web application can declare that it expects to load scripts from specific, trusted sources,
by including the following header in the response:</p>
<pre class="screen">Content-Security-Policy: script-src https://trustedscripts.example.com</pre>
<p>An attempt to load a script from another source other than what is declared in the <span class="emphasis"><em>script-src</em></span> directive will be blocked by the user-agent.
Additionally, if the <a class="ulink" href="https://www.w3.org/TR/CSP2/#directive-report-uri" target="_top"><span class="strong"><strong><span class="emphasis"><em>report-uri</em></span></strong></span></a> directive is declared in the security policy,
then the violation will be reported by the user-agent to the declared URL.</p>
<p>For example, if a web application violates the declared security policy,
the following response header will instruct the user-agent to send violation reports to the URL specified in the policy&#8217;s <span class="emphasis"><em>report-uri</em></span> directive.</p>
<pre class="screen">Content-Security-Policy: script-src https://trustedscripts.example.com; report-uri /csp-report-endpoint/</pre>
<p><a class="ulink" href="https://www.w3.org/TR/CSP2/#violation-reports" target="_top"><span class="strong"><strong><span class="emphasis"><em>Violation reports</em></span></strong></span></a> are standard JSON structures that can be captured
either by the web application&#8217;s own API or by a publicly hosted CSP violation reporting service, such as, <a class="ulink" href="https://report-uri.io/" target="_top"><span class="strong"><strong><span class="emphasis"><em>REPORT-URI</em></span></strong></span></a>.</p>
<p>The <span class="strong"><strong><span class="emphasis"><em>Content-Security-Policy-Report-Only</em></span></strong></span> header provides the capability for web application authors and administrators to monitor security policies, rather than enforce them.
This header is typically used when experimenting and/or developing security policies for a site.
When a policy is deemed effective, it can be enforced by using the <span class="emphasis"><em>Content-Security-Policy</em></span> header field instead.</p>
<p>Given the following response header, the policy declares that scripts may be loaded from one of two possible sources.</p>
<pre class="screen">Content-Security-Policy-Report-Only: script-src 'self' https://trustedscripts.example.com; report-uri /csp-report-endpoint/</pre>
<p>If the site violates this policy, by attempting to load a script from <span class="emphasis"><em>evil.com</em></span>,
the user-agent will send a violation report to the declared URL specified by the <span class="emphasis"><em>report-uri</em></span> directive,
but still allow the violating resource to load nevertheless.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="headers-csp-configure" href="#headers-csp-configure"></a>Configuring Content Security Policy</h4></div></div></div>

<p>It&#8217;s important to note that Spring Security <span class="strong"><strong><span class="emphasis"><em>does not add</em></span></strong></span> Content Security Policy by default.
The web application author must declare the security policy(s) to enforce and/or monitor for the protected resources.</p>
<p>For example, given the following security policy:</p>
<pre class="screen">script-src 'self' https://trustedscripts.example.com; object-src https://trustedplugins.example.com; report-uri /csp-report-endpoint/</pre>
<p>You can enable the CSP header using XML configuration with the <a class="link" href="appendix-namespace.html#nsa-content-security-policy" title="41.1.11&nbsp;<content-security-policy&gt;">&lt;content-security-policy</a>&gt; element as shown below:</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers&gt;</span>
		<span class="hl-tag">&lt;content-security-policy</span>
			<span class="hl-attribute">policy-directives</span>=<span class="hl-value">"script-src 'self' https://trustedscripts.example.com; object-src https://trustedplugins.example.com; report-uri /csp-report-endpoint/"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/headers&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span></pre>
<p>To enable the CSP <span class="emphasis"><em>'report-only'</em></span> header, configure the element as follows:</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers&gt;</span>
		<span class="hl-tag">&lt;content-security-policy</span>
			<span class="hl-attribute">policy-directives</span>=<span class="hl-value">"script-src 'self' https://trustedscripts.example.com; object-src https://trustedplugins.example.com; report-uri /csp-report-endpoint/"</span>
			<span class="hl-attribute">report-only</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/headers&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span></pre>
<p>Similarly, you can enable the CSP header using Java configuration as shown below:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
WebSecurityConfigurerAdapter {

<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
	http
	<span class="hl-comment">// ...</span>
	.headers()
		.contentSecurityPolicy(<span class="hl-string">"script-src 'self' https://trustedscripts.example.com; object-src https://trustedplugins.example.com; report-uri /csp-report-endpoint/"</span>);
}
}</pre>
<p>To enable the CSP <span class="emphasis"><em>'report-only'</em></span> header, provide the following Java configuration:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
WebSecurityConfigurerAdapter {

<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
	http
	<span class="hl-comment">// ...</span>
	.headers()
		.contentSecurityPolicy(<span class="hl-string">"script-src 'self' https://trustedscripts.example.com; object-src https://trustedplugins.example.com; report-uri /csp-report-endpoint/"</span>)
		.reportOnly();
}
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="headers-csp-links" href="#headers-csp-links"></a>Additional Resources</h4></div></div></div>

<p>Applying Content Security Policy to a web application is often a non-trivial undertaking.
The following resources may provide further assistance in developing effective security policies for your site.</p>
<p><a class="ulink" href="http://www.html5rocks.com/en/tutorials/security/content-security-policy/" target="_top">An Introduction to Content Security Policy</a></p>
<p><a class="ulink" href="https://developer.mozilla.org/en-US/docs/Web/Security/CSP" target="_top">CSP Guide - Mozilla Developer Network</a></p>
<p><a class="ulink" href="https://www.w3.org/TR/CSP2/" target="_top">W3C Candidate Recommendation</a></p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="headers-referrer" href="#headers-referrer"></a>20.1.8&nbsp;Referrer Policy</h3></div></div></div>

<p><a class="ulink" href="https://www.w3.org/TR/referrer-policy" target="_top">Referrer Policy</a> is a mechanism that web applications can leverage to manage the referrer field, which contains the last
page the user was on.</p>
<p>Spring Security&#8217;s approach is to use <a class="ulink" href="https://www.w3.org/TR/referrer-policy/" target="_top">Referrer Policy</a> header, which provides different <a class="ulink" href="https://www.w3.org/TR/referrer-policy/#referrer-policies" target="_top">policies</a>:</p>
<pre class="screen">Referrer-Policy: same-origin</pre>
<p>The Referrer-Policy response header instructs the browser to let the destination knows the source where the user was previously.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="headers-referrer-configure" href="#headers-referrer-configure"></a>Configuring Referrer Policy</h4></div></div></div>

<p>Spring Security <span class="strong"><strong><span class="emphasis"><em>doesn&#8217;t add</em></span></strong></span> Referrer Policy header by default.</p>
<p>You can enable the Referrer-Policy header using XML configuration with the <a class="link" href="appendix-namespace.html#nsa-referrer-policy" title="41.1.12&nbsp;<referrer-policy&gt;">&lt;referrer-policy</a>&gt; element as shown below:</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers&gt;</span>
		<span class="hl-tag">&lt;referrer-policy</span> <span class="hl-attribute">policy</span>=<span class="hl-value">"same-origin"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/headers&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span></pre>
<p>Similarly, you can enable the Referrer Policy header using Java configuration as shown below:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
WebSecurityConfigurerAdapter {

<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
	http
	<span class="hl-comment">// ...</span>
	.headers()
		.referrerPolicy(ReferrerPolicy.SAME_ORIGIN);
}
}</pre>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="headers-custom" href="#headers-custom"></a>20.2&nbsp;Custom Headers</h2></div></div></div>

<p>Spring Security has mechanisms to make it convenient to add the more common security headers to your application. However, it also provides hooks to enable adding custom headers.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="headers-static" href="#headers-static"></a>20.2.1&nbsp;Static Headers</h3></div></div></div>

<p>There may be times you wish to inject custom security headers into your application that are not supported out of the box.
For example, given the following custom security header:</p>
<pre class="screen">X-Custom-Security-Header: header-value</pre>
<p>When using the XML namespace, these headers can be added to the response using the <a class="link" href="appendix-namespace.html#nsa-header" title="41.1.16&nbsp;<header&gt;">&lt;header</a>&gt; element as shown below:</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers&gt;</span>
		<span class="hl-tag">&lt;header</span> <span class="hl-attribute">name</span>=<span class="hl-value">"X-Custom-Security-Header"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"header-value"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;/headers&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span></pre>
<p>Similarly, the headers could be added to the response using Java Configuration as shown in the following:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
WebSecurityConfigurerAdapter {

<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
	http
	<span class="hl-comment">// ...</span>
	.headers()
		.addHeaderWriter(<span class="hl-keyword">new</span> StaticHeadersWriter(<span class="hl-string">"X-Custom-Security-Header"</span>,<span class="hl-string">"header-value"</span>));
}
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="headers-writer" href="#headers-writer"></a>20.2.2&nbsp;Headers Writer</h3></div></div></div>

<p>When the namespace or Java configuration does not support the headers you want, you can create a custom <code class="literal">HeadersWriter</code> instance or even provide a custom implementation of the <code class="literal">HeadersWriter</code>.</p>
<p>Let&#8217;s take a look at an example of using an custom instance of <code class="literal">XFrameOptionsHeaderWriter</code>. Perhaps you want to allow framing of content for the same origin. This is easily supported by setting the <a class="link" href="appendix-namespace.html#nsa-frame-options-policy">policy</a> attribute to "SAMEORIGIN", but let&#8217;s take a look at a more explicit example using the <a class="link" href="appendix-namespace.html#nsa-header-ref">ref</a> attribute.</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers&gt;</span>
		<span class="hl-tag">&lt;header</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"frameOptionsWriter"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;/headers&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span>
<span class="hl-comment">&lt;!-- Requires the c-namespace.
See http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-c-namespace
--&gt;</span>
<span class="hl-tag">&lt;beans:bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"frameOptionsWriter"</span>
	<span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.security.web.header.writers.frameoptions.XFrameOptionsHeaderWriter"</span>
	<span class="hl-attribute">c:frameOptionsMode</span>=<span class="hl-value">"SAMEORIGIN"</span><span class="hl-tag">/&gt;</span></pre>
<p>We could also restrict framing of content to the same origin with Java configuration:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
WebSecurityConfigurerAdapter {

<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
	http
	<span class="hl-comment">// ...</span>
	.headers()
		.addHeaderWriter(<span class="hl-keyword">new</span> XFrameOptionsHeaderWriter(XFrameOptionsMode.SAMEORIGIN));
}
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="headers-delegatingrequestmatcherheaderwriter" href="#headers-delegatingrequestmatcherheaderwriter"></a>20.2.3&nbsp;DelegatingRequestMatcherHeaderWriter</h3></div></div></div>

<p>At times you may want to only write a header for certain requests. For example, perhaps you want to only protect your log in page from being framed. You could use the <code class="literal">DelegatingRequestMatcherHeaderWriter</code> to do so. When using the XML namespace configuration, this can be done with the following:</p>
<pre class="programlisting"><span class="hl-tag">&lt;http&gt;</span>
	<span class="hl-comment">&lt;!-- ... --&gt;</span>

	<span class="hl-tag">&lt;headers&gt;</span>
		<span class="hl-tag">&lt;frame-options</span> <span class="hl-attribute">disabled</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
		<span class="hl-tag">&lt;header</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"headerWriter"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;/headers&gt;</span>
<span class="hl-tag">&lt;/http&gt;</span>

<span class="hl-tag">&lt;beans:bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"headerWriter"</span>
	<span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.security.web.header.writers.DelegatingRequestMatcherHeaderWriter"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;beans:constructor-arg&gt;</span>
		<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.security.web.util.matcher.AntPathRequestMatcher"</span>
			<span class="hl-attribute">c:pattern</span>=<span class="hl-value">"/login"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;/beans:constructor-arg&gt;</span>
	<span class="hl-tag">&lt;beans:constructor-arg&gt;</span>
		<span class="hl-tag">&lt;beans:bean</span>
			<span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.security.web.header.writers.frameoptions.XFrameOptionsHeaderWriter"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;/beans:constructor-arg&gt;</span>
<span class="hl-tag">&lt;/beans:bean&gt;</span></pre>
<p>We could also prevent framing of content to the log in page using java configuration:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebSecurity</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSecurityConfig <span class="hl-keyword">extends</span>
WebSecurityConfigurerAdapter {

<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configure(HttpSecurity http) <span class="hl-keyword">throws</span> Exception {
	RequestMatcher matcher = <span class="hl-keyword">new</span> AntPathRequestMatcher(<span class="hl-string">"/login"</span>);
	DelegatingRequestMatcherHeaderWriter headerWriter =
		<span class="hl-keyword">new</span> DelegatingRequestMatcherHeaderWriter(matcher,<span class="hl-keyword">new</span> XFrameOptionsHeaderWriter());
	http
	<span class="hl-comment">// ...</span>
	.headers()
		.frameOptions().disabled()
		.addHeaderWriter(headerWriter);
}
}</pre>
</div>
</div>
</div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="cors.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="web-app-security.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="session-mgmt.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">19.&nbsp;CORS&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;21.&nbsp;Session Management</td></tr></table></div></body></html>