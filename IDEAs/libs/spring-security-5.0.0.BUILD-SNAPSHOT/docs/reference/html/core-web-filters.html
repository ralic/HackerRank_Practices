<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>14.&nbsp;Core Security Filters</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Security Reference"><link rel="up" href="web-app-security.html" title="Part&nbsp;IV.&nbsp;Web Application Security"><link rel="prev" href="security-filter-chain.html" title="13.&nbsp;The Security Filter Chain"><link rel="next" href="servletapi.html" title="15.&nbsp;Servlet API integration"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.&nbsp;Core Security Filters</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="security-filter-chain.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;IV.&nbsp;Web Application Security</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="servletapi.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="core-web-filters" href="#core-web-filters"></a>14.&nbsp;Core Security Filters</h2></div></div></div>

<p>There are some key filters which will always be used in a web application which uses Spring Security, so we&#8217;ll look at these and their supporting classes and interfaces first. We won&#8217;t cover every feature, so be sure to look at the Javadoc for them if you want to get the complete picture.</p>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="filter-security-interceptor" href="#filter-security-interceptor"></a>14.1&nbsp;FilterSecurityInterceptor</h2></div></div></div>

<p>We&#8217;ve already seen <code class="literal">FilterSecurityInterceptor</code> briefly when discussing <a class="link" href="technical-overview.html#tech-intro-access-control" title="9.5&nbsp;Access-Control (Authorization) in Spring Security">access-control in general</a>, and we&#8217;ve already used it with the namespace where the <code class="literal">&lt;intercept-url&gt;</code> elements are combined to configure it internally. Now we&#8217;ll see how to explicitly configure it for use with a <code class="literal">FilterChainProxy</code>, along with its companion filter <code class="literal">ExceptionTranslationFilter</code>. A typical configuration example is shown below:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"filterSecurityInterceptor"</span>
	<span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.security.web.access.intercept.FilterSecurityInterceptor"</span><span class="hl-tag">&gt;</span>
<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"authenticationManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"authenticationManager"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"accessDecisionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accessDecisionManager"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"securityMetadataSource"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;security:filter-security-metadata-source&gt;</span>
	<span class="hl-tag">&lt;security:intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"/secure/super/**"</span> <span class="hl-attribute">access</span>=<span class="hl-value">"ROLE_WE_DONT_HAVE"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;security:intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"/secure/**"</span> <span class="hl-attribute">access</span>=<span class="hl-value">"ROLE_SUPERVISOR,ROLE_TELLER"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;/security:filter-security-metadata-source&gt;</span>
<span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p><code class="literal">FilterSecurityInterceptor</code> is responsible for handling the security of HTTP resources. It requires a reference to an <code class="literal">AuthenticationManager</code> and an <code class="literal">AccessDecisionManager</code>. It is also supplied with configuration attributes that apply to different HTTP URL requests. Refer back to <a class="link" href="technical-overview.html#tech-intro-config-attributes" title="What are Configuration Attributes?">the original discussion on these</a> in the technical introduction.</p>
<p>The <code class="literal">FilterSecurityInterceptor</code> can be configured with configuration attributes in two ways. The first, which is shown above, is using the <code class="literal">&lt;filter-security-metadata-source&gt;</code> namespace element. This is similar to the <code class="literal">&lt;http&gt;</code> element from the namespace chapter but the <code class="literal">&lt;intercept-url&gt;</code> child elements only use the <code class="literal">pattern</code> and <code class="literal">access</code> attributes. Commas are used to delimit the different configuration attributes that apply to each HTTP URL. The second option is to write your own <code class="literal">SecurityMetadataSource</code>, but this is beyond the scope of this document. Irrespective of the approach used, the <code class="literal">SecurityMetadataSource</code> is responsible for returning a <code class="literal">List&lt;ConfigAttribute&gt;</code> containing all of the configuration attributes associated with a single secure HTTP URL.</p>
<p>It should be noted that the <code class="literal">FilterSecurityInterceptor.setSecurityMetadataSource()</code> method actually expects an instance of <code class="literal">FilterInvocationSecurityMetadataSource</code>. This is a marker interface which subclasses <code class="literal">SecurityMetadataSource</code>. It simply denotes the <code class="literal">SecurityMetadataSource</code> understands <code class="literal">FilterInvocation</code> s. In the interests of simplicity we&#8217;ll continue to refer to the <code class="literal">FilterInvocationSecurityMetadataSource</code> as a <code class="literal">SecurityMetadataSource</code>, as the distinction is of little relevance to most users.</p>
<p>The <code class="literal">SecurityMetadataSource</code> created by the namespace syntax obtains the configuration attributes for a particular <code class="literal">FilterInvocation</code> by matching the request URL against the configured <code class="literal">pattern</code> attributes. This behaves in the same way as it does for namespace configuration. The default is to treat all expressions as Apache Ant paths and regular expressions are also supported for more complex cases. The <code class="literal">request-matcher</code> attribute is used to specify the type of pattern being used. It is not possible to mix expression syntaxes within the same definition. As an example, the previous configuration using regular expressions instead of Ant paths would be written as follows:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"filterInvocationInterceptor"</span>
	<span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.security.web.access.intercept.FilterSecurityInterceptor"</span><span class="hl-tag">&gt;</span>
<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"authenticationManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"authenticationManager"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"accessDecisionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accessDecisionManager"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"runAsManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"runAsManager"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"securityMetadataSource"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;security:filter-security-metadata-source</span> <span class="hl-attribute">request-matcher</span>=<span class="hl-value">"regex"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;security:intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"\A/secure/super/.*\Z"</span> <span class="hl-attribute">access</span>=<span class="hl-value">"ROLE_WE_DONT_HAVE"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;security:intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"\A/secure/.*\"</span> <span class="hl-attribute">access</span>=<span class="hl-value">"ROLE_SUPERVISOR,ROLE_TELLER"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;/security:filter-security-metadata-source&gt;</span>
<span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>Patterns are always evaluated in the order they are defined. Thus it is important that more specific patterns are defined higher in the list than less specific patterns. This is reflected in our example above, where the more specific <code class="literal">/secure/super/</code> pattern appears higher than the less specific <code class="literal">/secure/</code> pattern. If they were reversed, the <code class="literal">/secure/</code> pattern would always match and the <code class="literal">/secure/super/</code> pattern would never be evaluated.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="exception-translation-filter" href="#exception-translation-filter"></a>14.2&nbsp;ExceptionTranslationFilter</h2></div></div></div>

<p>The <code class="literal">ExceptionTranslationFilter</code> sits above the <code class="literal">FilterSecurityInterceptor</code> in the security filter stack. It doesn&#8217;t do any actual security enforcement itself, but handles exceptions thrown by the security interceptors and provides suitable and HTTP responses.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exceptionTranslationFilter"</span>
<span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.security.web.access.ExceptionTranslationFilter"</span><span class="hl-tag">&gt;</span>
<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"authenticationEntryPoint"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"authenticationEntryPoint"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"accessDeniedHandler"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accessDeniedHandler"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"authenticationEntryPoint"</span>
<span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint"</span><span class="hl-tag">&gt;</span>
<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"loginFormUrl"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/login.jsp"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accessDeniedHandler"</span>
	<span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.security.web.access.AccessDeniedHandlerImpl"</span><span class="hl-tag">&gt;</span>
<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"errorPage"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/accessDenied.htm"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="auth-entry-point" href="#auth-entry-point"></a>14.2.1&nbsp;AuthenticationEntryPoint</h3></div></div></div>

<p>The <code class="literal">AuthenticationEntryPoint</code> will be called if the user requests a secure HTTP resource but they are not authenticated. An appropriate <code class="literal">AuthenticationException</code> or <code class="literal">AccessDeniedException</code> will be thrown by a security interceptor further down the call stack, triggering the <code class="literal">commence</code> method on the entry point. This does the job of presenting the appropriate response to the user so that authentication can begin. The one we&#8217;ve used here is <code class="literal">LoginUrlAuthenticationEntryPoint</code>, which redirects the request to a different URL (typically a login page). The actual implementation used will depend on the authentication mechanism you want to be used in your application.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="access-denied-handler" href="#access-denied-handler"></a>14.2.2&nbsp;AccessDeniedHandler</h3></div></div></div>

<p>What happens if a user is already authenticated and they try to access a protected resource? In normal usage, this shouldn&#8217;t happen because the application workflow should be restricted to operations to which a user has access. For example, an HTML link to an administration page might be hidden from users who do not have an admin role. You can&#8217;t rely on hiding links for security though, as there&#8217;s always a possibility that a user will just enter the URL directly in an attempt to bypass the restrictions. Or they might modify a RESTful URL to change some of the argument values. Your application must be protected against these scenarios or it will definitely be insecure. You will typically use simple web layer security to apply constraints to basic URLs and use more specific method-based security on your service layer interfaces to really nail down what is permissible.</p>
<p>If an <code class="literal">AccessDeniedException</code> is thrown and a user has already been authenticated, then this means that an operation has been attempted for which they don&#8217;t have enough permissions. In this case, <code class="literal">ExceptionTranslationFilter</code> will invoke a second strategy, the <code class="literal">AccessDeniedHandler</code>. By default, an <code class="literal">AccessDeniedHandlerImpl</code> is used, which just sends a 403 (Forbidden) response to the client. Alternatively you can configure an instance explicitly (as in the above example) and set an error page URL which it will forwards the request to <a href="#ftn.d5e2639" class="footnote" name="d5e2639"><sup class="footnote">[11]</sup></a>. This can be a simple "access denied" page, such as a JSP, or it could be a more complex handler such as an MVC controller. And of course, you can implement the interface yourself and use your own implementation.</p>
<p>It&#8217;s also possible to supply a custom <code class="literal">AccessDeniedHandler</code> when you&#8217;re using the namespace to configure your application. See <a class="link" href="appendix-namespace.html#nsa-access-denied-handler" title="41.1.3&nbsp;<access-denied-handler&gt;">the namespace appendix</a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="request-caching" href="#request-caching"></a>14.2.3&nbsp;SavedRequest s and the RequestCache Interface</h3></div></div></div>

<p>Another responsibility of <code class="literal">ExceptionTranslationFilter</code> responsibilities is to save the current request before invoking the <code class="literal">AuthenticationEntryPoint</code>. This allows the request to be restored after the user has authenticated (see previous overview of <a class="link" href="technical-overview.html#tech-intro-web-authentication" title="9.4&nbsp;Authentication in a Web Application">web authentication</a>). A typical example would be where the user logs in with a form, and is then redirected to the original URL by the default <code class="literal">SavedRequestAwareAuthenticationSuccessHandler</code> (see <a class="link" href="core-web-filters.html#form-login-flow-handling" title="14.4.1&nbsp;Application Flow on Authentication Success and Failure">below</a>).</p>
<p>The <code class="literal">RequestCache</code> encapsulates the functionality required for storing and retrieving <code class="literal">HttpServletRequest</code> instances. By default the <code class="literal">HttpSessionRequestCache</code> is used, which stores the request in the <code class="literal">HttpSession</code>. The <code class="literal">RequestCacheFilter</code> has the job of actually restoring the saved request from the cache when the user is redirected to the original URL.</p>
<p>Under normal circumstances, you shouldn&#8217;t need to modify any of this functionality, but the saved-request handling is a "best-effort" approach and there may be situations which the default configuration isn&#8217;t able to handle. The use of these interfaces makes it fully pluggable from Spring Security 3.0 onwards.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-context-persistence-filter" href="#security-context-persistence-filter"></a>14.3&nbsp;SecurityContextPersistenceFilter</h2></div></div></div>

<p>We covered the purpose of this all-important filter in the <a class="link" href="technical-overview.html#tech-intro-sec-context-persistence" title="9.4.4&nbsp;Storing the SecurityContext between requests">Technical Overview</a> chapter so you might want to re-read that section at this point. Let&#8217;s first take a look at how you would configure it for use with a <code class="literal">FilterChainProxy</code>. A basic configuration only requires the bean itself</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"securityContextPersistenceFilter"</span>
<span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.security.web.context.SecurityContextPersistenceFilter"</span><span class="hl-tag">/&gt;</span></pre>
<p>As we saw previously, this filter has two main tasks. It is responsible for storage of the <code class="literal">SecurityContext</code> contents between HTTP requests and for clearing the <code class="literal">SecurityContextHolder</code> when a request is completed. Clearing the <code class="literal">ThreadLocal</code> in which the context is stored is essential, as it might otherwise be possible for a thread to be replaced into the servlet container&#8217;s thread pool, with the security context for a particular user still attached. This thread might then be used at a later stage, performing operations with the wrong credentials.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-context-repository" href="#security-context-repository"></a>14.3.1&nbsp;SecurityContextRepository</h3></div></div></div>

<p>From Spring Security 3.0, the job of loading and storing the security context is now delegated to a separate strategy interface:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> SecurityContextRepository {

SecurityContext loadContext(HttpRequestResponseHolder requestResponseHolder);

<span class="hl-keyword">void</span> saveContext(SecurityContext context, HttpServletRequest request,
		HttpServletResponse response);
}</pre>
<p>The <code class="literal">HttpRequestResponseHolder</code> is simply a container for the incoming request and response objects, allowing the implementation to replace these with wrapper classes. The returned contents will be passed to the filter chain.</p>
<p>The default implementation is <code class="literal">HttpSessionSecurityContextRepository</code>, which stores the security context as an <code class="literal">HttpSession</code> attribute <a href="#ftn.d5e2678" class="footnote" name="d5e2678"><sup class="footnote">[12]</sup></a>. The most important configuration parameter for this implementation is the <code class="literal">allowSessionCreation</code> property, which defaults to <code class="literal">true</code>, thus allowing the class to create a session if it needs one to store the security context for an authenticated user (it won&#8217;t create one unless authentication has taken place and the contents of the security context have changed). If you don&#8217;t want a session to be created, then you can set this property to <code class="literal">false</code>:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"securityContextPersistenceFilter"</span>
	<span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.security.web.context.SecurityContextPersistenceFilter"</span><span class="hl-tag">&gt;</span>
<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">'securityContextRepository'</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">'org.springframework.security.web.context.HttpSessionSecurityContextRepository'</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">'allowSessionCreation'</span> <span class="hl-attribute">value</span>=<span class="hl-value">'false'</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>Alternatively you could provide an instance of <code class="literal">NullSecurityContextRepository</code>, a <a class="ulink" href="http://en.wikipedia.org/wiki/Null_Object_pattern" target="_top">null object</a> implementation, which will prevent the security context from being stored, even if a session has already been created during the request.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="form-login-filter" href="#form-login-filter"></a>14.4&nbsp;UsernamePasswordAuthenticationFilter</h2></div></div></div>

<p>We&#8217;ve now seen the three main filters which are always present in a Spring Security web configuration. These are also the three which are automatically created by the namespace <code class="literal">&lt;http&gt;</code> element and cannot be substituted with alternatives. The only thing that&#8217;s missing now is an actual authentication mechanism, something that will allow a user to authenticate. This filter is the most commonly used authentication filter and the one that is most often customized <a href="#ftn.d5e2693" class="footnote" name="d5e2693"><sup class="footnote">[13]</sup></a>. It also provides the implementation used by the <code class="literal">&lt;form-login&gt;</code> element from the namespace. There are three stages required to configure it.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Configure a <code class="literal">LoginUrlAuthenticationEntryPoint</code> with the URL of the login page, just as we did above, and set it on the <code class="literal">ExceptionTranslationFilter</code>.
</li><li class="listitem">
Implement the login page (using a JSP or MVC controller).
</li><li class="listitem">
Configure an instance of <code class="literal">UsernamePasswordAuthenticationFilter</code> in the application context
</li><li class="listitem">
Add the filter bean to your filter chain proxy (making sure you pay attention to the order).
</li></ul></div>
<p>The login form simply contains <code class="literal">username</code> and <code class="literal">password</code> input fields, and posts to the URL that is monitored by the filter (by default this is <code class="literal">/login</code>). The basic filter configuration looks something like this:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"authenticationFilter"</span> <span class="hl-attribute">class</span>=
<span class="hl-value">"org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter"</span><span class="hl-tag">&gt;</span>
<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"authenticationManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"authenticationManager"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="form-login-flow-handling" href="#form-login-flow-handling"></a>14.4.1&nbsp;Application Flow on Authentication Success and Failure</h3></div></div></div>

<p>The filter calls the configured <code class="literal">AuthenticationManager</code> to process each authentication request. The destination following a successful authentication or an authentication failure is controlled by the <code class="literal">AuthenticationSuccessHandler</code> and <code class="literal">AuthenticationFailureHandler</code> strategy interfaces, respectively. The filter has properties which allow you to set these so you can customize the behaviour completely <a href="#ftn.d5e2721" class="footnote" name="d5e2721"><sup class="footnote">[14]</sup></a>. Some standard implementations are supplied such as <code class="literal">SimpleUrlAuthenticationSuccessHandler</code>, <code class="literal">SavedRequestAwareAuthenticationSuccessHandler</code>, <code class="literal">SimpleUrlAuthenticationFailureHandler</code>, <code class="literal">ExceptionMappingAuthenticationFailureHandler</code> and <code class="literal">DelegatingAuthenticationFailureHandler</code>. Have a look at the Javadoc for these classes and also for <code class="literal">AbstractAuthenticationProcessingFilter</code> to get an overview of how they work and the supported features.</p>
<p>If authentication is successful, the resulting <code class="literal">Authentication</code> object will be placed into the <code class="literal">SecurityContextHolder</code>. The configured <code class="literal">AuthenticationSuccessHandler</code> will then be called to either redirect or forward the user to the appropriate destination. By default a <code class="literal">SavedRequestAwareAuthenticationSuccessHandler</code> is used, which means that the user will be redirected to the original destination they requested before they were asked to login.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The <code class="literal">ExceptionTranslationFilter</code> caches the original request a user makes. When the user authenticates, the request handler makes use of this cached request to obtain the original URL and redirect to it. The original request is then rebuilt and used as an alternative.</p>
</td></tr></table></div>
<p>If authentication fails, the configured <code class="literal">AuthenticationFailureHandler</code> will be invoked.</p>
</div>
</div>
<div class="footnotes"><br><hr style="width:100; text-align:left;margin-left: 0"><div id="ftn.d5e2639" class="footnote"><p><a href="#d5e2639" class="simpara"><sup class="simpara">[11] </sup></a>We use a forward so that the SecurityContextHolder still contains details of the principal, which may be useful for displaying to the user. In old releases of Spring Security we relied upon the servlet container to handle a 403 error message, which lacked this useful contextual information.</p></div><div id="ftn.d5e2678" class="footnote"><p><a href="#d5e2678" class="simpara"><sup class="simpara">[12] </sup></a>In Spring Security 2.0 and earlier, this filter was called <code class="literal">HttpSessionContextIntegrationFilter</code> and performed all the work of storing the context was performed by the filter itself. If you were familiar with this class, then most of the configuration options which were available can now be found on <code class="literal">HttpSessionSecurityContextRepository</code>.</p></div><div id="ftn.d5e2693" class="footnote"><p><a href="#d5e2693" class="simpara"><sup class="simpara">[13] </sup></a>For historical reasons, prior to Spring Security 3.0, this filter was called <code class="literal">AuthenticationProcessingFilter</code> and the entry point was called <code class="literal">AuthenticationProcessingFilterEntryPoint</code>. Since the framework now supports many different forms of authentication, they have both been given more specific names in 3.0.</p></div><div id="ftn.d5e2721" class="footnote"><p><a href="#d5e2721" class="simpara"><sup class="simpara">[14] </sup></a>In versions prior to 3.0, the application flow at this point had evolved to a stage was controlled by a mix of properties on this class and strategy plugins. The decision was made for 3.0 to refactor the code to make these two strategies entirely responsible.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="security-filter-chain.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="web-app-security.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="servletapi.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">13.&nbsp;The Security Filter Chain&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;15.&nbsp;Servlet API integration</td></tr></table></div></body></html>